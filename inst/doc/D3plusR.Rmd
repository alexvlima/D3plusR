---
title: "D3plusR - Examples"
author: "Paulo Oliveira"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## About D3plus

[D3plus](https://d3plus.org/) is a javascript library build on top of D3.js. The idea of D3plusR package is supply a R interface to this (D3plus) javascript library. The original package has several methods. Almost every method will be available in a R function. However, some of them are grouped in a specific function: `d3plus()` To know about those methods see [this page](https://github.com/alexandersimoes/d3plus/wiki/Visualizations).

Below we see an example in the original javascript library:

```js
var visualization = d3plus.viz()
    .container("#viz")
    .data(data)
    .type("bar")
    .id("name")
    .x("year")
    .y("value")
    .draw()
```

In this R package the code above is translated in this way:

```{r, eval=FALSE}
d3plus(data = data,
       type = "bar",
       id = "name") %>% 
  d3plusX(value = "year") %>% 
  d3plusY(value = "value")
```

If a method key (option) can receive other keys (options), this must be supplied as list.

## Bar Chart

The data for first example comes from the [Comtrade API](https://comtrade.un.org/data/doc/api). By default, the D3plus library adds the symbol `%` to variables named `share`. To include this symbol in other variables use the `percent_var` argument. To add methods to the chart, use the ` %>% ` operator.

```{r, message=FALSE, warning=FALSE}
library(D3plusR)
library(dplyr)
data("trade_bra_chn")

# Fake shares
trade_bra_chn <- trade_bra_chn %>% 
  mutate(share = sample(100, nrow(trade_bra_chn), replace = TRUE))

dictionary <- list(TradeValue = "Trade Value", Period = "Year",
                   share = "Share")

attributes <- list(Trade.Flow = data.frame(Trade.Flow = c("Export", "Import"),
                             icon = c("exp.png",
                                      "imp.png"),
                             hex = c("#344969", "#992234")))

d3plus(data = trade_bra_chn, id = "Trade.Flow",
       type = "bar",
       title = "Brazilian Exports and Imports to/from China",
       dictionary = dictionary,
       height = 400,
       width = "100%") %>% 
  d3plusX(value = "Period") %>% 
  d3plusY(value = "TradeValue") %>% 
  d3plusLegend(value = TRUE, size = 30, data = FALSE) %>% 
  d3plusTooltip(value = c("Period", "TradeValue", "share")) %>% 
  d3plusAttributes(value = attributes) %>% 
  d3plusColor(value = "hex") %>% 
  d3plusIcon(value = "icon", style = "knockout")
```

## Line chart 

The example below uses `type = "line"` and adds the `d3plusTime()` function (`.time()` method).


```{r}
data("bra_inflation")

# dates to be passed in solo argument
date_filter <- bra_inflation$Date[bra_inflation$Date > "2013/01/01"]


d3plus(data = bra_inflation, id = "country",
       type = "line",
       title = "Brazilian Inflation (IPCA)",
       percent_var = "Rate",
       height = 400,
       width = "100%") %>% 
  d3plusX(value = "Date", grid = FALSE) %>% 
  d3plusY(value = "Rate") %>% 
  d3plusTime(value = "Date", solo = date_filter) %>% 
  d3plusTooltip(value = "Date")

```

## Treemap

```{r}
data("bra_exp_2015")
d3plus(data = bra_exp_2015,
       type = "tree_map",
       id = c("region", "Partner"),
       width = "100%",
       height = 500) %>% 
  d3plusSize(value = "Trade.Value..US..") %>% 
  d3plusLegend(value = TRUE, order = list(sort = "desc", value = "size")) %>% 
  d3plusColor("region") %>% 
  d3plusDepth(1) %>% 
  d3plusLabels(valign = "top")
```

## Geo Map

```{r}
mapa <- system.file("extdata", "countries.topojson", package = "D3plusR")
mapa <- jsonlite::fromJSON(mapa, simplifyVector = F)

d3 <- d3plus(data = bra_exp_2015,
       type = "geo_map",
       id = "Partner.ISO",
       title = "Brazilian Exports Destinations",
       width = "100%",
       height = 500) %>% 
  d3plusCoords(mapa, projection = "equirectangular") %>% 
  d3plusColor(value = "Trade.Value..US..") %>% 
  d3plusTooltip(value = c("Trade.Value..US..", "Partner")) %>% 
  d3plusLabels(FALSE)

d3

```

